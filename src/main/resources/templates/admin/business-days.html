<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{parts/admin-common :: html_head('営業日設定 - 管理者画面')}"></head>
<body class="bg-light text-dark">
	<div class="d-flex flex-column min-vh-100 bg-light">
		<header th:replace="~{parts/admin-common :: header}"></header>

		<main class="container flex-grow-1 py-4">
			<div class="narrow-table-container">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<h1 class="h2">営業日設定</h1>
				</div>
				<div class="mb-4 text-end">
					<a href="/admin/main" class="btn btn-outline-primary">予約一覧へ戻る</a>
				</div>
			</div>

			<!-- メッセージ表示 -->
			<div th:if="${message}" class="alert alert-success narrow-table-container"
				th:text="${message}"></div>
			<div th:if="${error}" class="alert alert-danger narrow-table-container" th:text="${error}"></div>

			<!-- 営業日追加フォーム -->
			<div class="card shadow-sm mb-4 narrow-table-container">
				<div class="card-body">
					<form th:action="@{/admin/business-days/add}" method="post"
						class="row g-3">
						<div class="col-auto">
							<input type="date" name="date" class="form-control" required />
						</div>
						<div class="col-auto">
							<select name="businessType" class="form-select">
								<option value="allday">終日</option>
								<option value="am">午前</option>
								<option value="pm">午後</option>
							</select>
						</div>
						<div class="col-auto">
							<button type="submit" class="btn btn-primary">追加</button>
						</div>
						<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}" />
					</form>
				</div>
			</div>

			<!-- 営業日一覧 -->
			<div class="card shadow-sm narrow-table-container">
				<div class="card-body">
					<table class="table table-hover align-middle">
						<thead>
							<tr>
								<th>日付</th>
								<th>営業形態</th>
								<th>状態</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="day : ${businessDays}">
								<td th:text="${day.businessDateLabel}"></td>
								<td>
									<div class="dropdown">
										<button
											class="btn btn-outline-secondary btn-sm dropdown-toggle"
											type="button" data-bs-toggle="dropdown" aria-expanded="false"
											th:text="${day.businessTypeDisplayName}"></button>
										<ul class="dropdown-menu">
											<li th:each="type : ${businessTypes}">
												<form th:action="@{/admin/business-days/update-type}"
													method="post" style="display: inline;">
													<input type="hidden" name="id" th:value="${day.id}" /> <input
														type="hidden" name="businessType" th:value="${type}" /> <input
														type="hidden" th:name="${_csrf.parameterName}"
														th:value="${_csrf.token}" />
													<button type="submit"
														th:class="${day.businessType == type ? 'dropdown-item active' : 'dropdown-item'}"
														th:text="${type == 'allday' ? '終日' : (type == 'am' ? '午前' : '午後')}"
														onclick="event.stopPropagation();"></button>
												</form>
											</li>
										</ul>
									</div>
								</td>
								<td><span th:text="${day.isActive ? '営業中' : '休業中'}"
									th:class="${day.isActive ? 'badge bg-success' : 'badge bg-secondary'}">
								</span></td>
								<td>
									<form th:action="@{/admin/business-days/toggle}" method="post"
										style="display: inline;">
										<input type="hidden" name="id" th:value="${day.id}" /> <input
											type="hidden" th:name="${_csrf.parameterName}"
											th:value="${_csrf.token}" />
										<button type="submit"
											th:class="${day.isActive ? 'btn btn-warning btn-sm' : 'btn btn-success btn-sm'}"
											th:text="${day.isActive ? '休業' : '再開'}"
											onclick="return confirm('営業状態を変更しますか？');"></button>
									</form>
									<form th:action="@{/admin/business-days/delete}" method="post"
										style="display: inline;">
										<input type="hidden" name="id" th:value="${day.id}" /> <input
											type="hidden" th:name="${_csrf.parameterName}"
											th:value="${_csrf.token}" />
										<button type="submit" class="btn btn-danger btn-sm ms-1"
											onclick="return confirm('本当に削除しますか？この操作は取り消せません。');">
											削除</button>
									</form>
								</td>
							</tr>
							<tr th:if="${#lists.isEmpty(businessDays)}">
								<td colspan="4" class="text-center text-muted">営業日が登録されていません。</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</main>
		<footer th:replace="~{parts/admin-common :: footer}"></footer>
	</div>
	<script src="/js/bootstrap.bundle.min.js"></script>
</body>
</html>