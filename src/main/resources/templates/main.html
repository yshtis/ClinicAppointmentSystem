<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{parts/common :: html_head('診断予約 - さわやか医院予約システム')}"></head>
<link rel="stylesheet" th:href="@{/css/parts/main.css}">
<body>
	<header th:replace="~{parts/common :: header()}"></header>
	<div class="container py-4">
		<div class="row justify-content-center">
			<!-- パネル -->
			<div class="col-12 col-md-10 col-lg-8">
				<div class="row g-0 shadow-sm"
					style="border-radius: 1.5rem; overflow: hidden; background: #fff;">
					<!-- タイトル行 -->
					<div class="col-12">
						<h2 class="mb-0 py-3 text-center" style="font-weight: bold;">予約日時を選択</h2>
						<hr class="my-0">
					</div>
					<!-- 営業日選択フォーム -->
					<div class="col-md-6 border-end" style="background: #f9fbfe;">
						<div
							class="p-4 h-100 d-flex flex-column gap-3 flex-grow-1 text-center">
							<label class="form-label mb-3">営業日を選択：</label>
							<div class="d-flex flex-column gap-3 flex-grow-1">
								<a th:each="day, iter : ${businessDays}"
									th:href="@{/main(businessDate=${day.businessDate})}"
									th:classappend="${day.businessDate == selectedBusinessDate} ? 'btn btn-primary' : 'btn btn-outline-primary'"
									class="btn business-day-btn py-2" style="margin-bottom: 6px;"
									th:styleappend="${iter.last} ? 'margin-bottom:0;' : ''">
									<div>
										<span
											th:text="${#temporals.format(day.businessDateAsLocalDate, 'yyyy/MM/dd (E)', 'Asia/Tokyo')}"></span>
									</div>
									<div>
										<small class="badge business-type-badge ms-1"
											th:class="'badge business-type-badge ms-1 ' + ${day.getBusinessTypeButtonClass()}"
											th:text="${day.getBusinessTypeDisplayName()}"></small>
									</div>
								</a>
							</div>
						</div>
					</div>
					<!-- 時間枠選択フォーム -->
					<div class="col-md-6" style="padding: 2rem;">
						<div th:if="${selectedBusinessDate != null}">
							<label class="form-label mb-3">予約時間を選択：</label>
							<form th:action="@{/confirm}" method="get" id="timeSlotForm">
								<input type="hidden" name="businessDate"
									th:value="${selectedBusinessDate}" />
								<div th:each="slot : ${allTimeSlots}" class="mb-2">
									<label th:for="'slot_' + ${slot.id}" class="me-2"> <input
										type="radio" name="timeSlotId" th:id="'slot_' + ${slot.id}"
										th:value="${slot.id}"
										th:disabled="${bookedSlotIds.contains(slot.id)}"
										onclick="onSlotSelect()" /> <span th:text="${slot.label}"></span>

									</label> <span th:if="${bookedSlotIds.contains(slot.id)}"
										class="badge bg-secondary">予約済</span>
								</div>
								<div class="d-flex w-100 justify-content-center button-row mt-3">
									<button type="submit" class="btn btn-primary" id="reserveBtn"
										disabled>予約を登録する</button>
									<a href="/main" class="btn btn-outline-secondary ms-2">戻る</a>
								</div>
							</form>
							<script>
								function onSlotSelect() {
									document.getElementById('reserveBtn').disabled = false;
								}
							</script>
						</div>
						<div th:unless="${selectedBusinessDate != null}"
							class="h-100 d-flex" style="min-height: 200px;">
							<span class="text-secondary">営業日を選択してください</span>
						</div>
					</div>
				</div>
			</div>
			<!-- /col -->
		</div>
		<!-- /row -->
	</div>
	<footer th:replace="~{parts/common :: footer()}"></footer>
</body>
</html>