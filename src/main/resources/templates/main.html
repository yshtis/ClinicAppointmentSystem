<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{parts/common :: html_head('診断予約 - さわやか医院予約システム')}"></head>
<link rel="stylesheet" th:href="@{/css/parts/main.css}">
<body>
	<header th:replace="~{parts/common :: header()}"></header>
	<div class="container py-4">
		<div class="row justify-content-center">
			<!-- カード風パネル -->
			<div class="col-12 col-md-10 col-lg-8">
				<div class="row g-0 shadow-sm"
					style="border-radius: 1.5rem; overflow: hidden; background: #fff;">
					<!-- タイトル行 -->
					<div class="col-12">
						<h2 class="mb-0 py-3 text-center" style="font-weight: bold;">予約時間を選択</h2>
						<hr class="my-0">
					</div>
					<!-- 営業日選択フォーム -->
					<div class="col-md-5 border-end" style="background: #f9fbfe;">
						<div class="p-4 h-100 d-flex flex-column">
							<label class="form-label mb-3">営業日を選択：</label>
							<div class="d-flex flex-column gap-3 flex-grow-1">
								<a th:each="day, iter : ${businessDays}"
									th:href="@{/main(businessDayId=${day.id})}"
									th:text="${#temporals.format(day.businessDate, 'yyyy/MM/dd (E)', 'Asia/Tokyo')}"
									th:classappend="${day.id == selectedBusinessDayId} ? 'btn btn-primary' : 'btn btn-outline-primary'"
									class="btn w-100 py-2" style="margin-bottom: 6px;"
									th:styleappend="${iter.last} ? 'margin-bottom:0;' : ''"> </a>
							</div>
						</div>
					</div>
					<!-- 時間枠選択フォーム -->
					<div class="col-md-7">
						<div th:if="${selectedBusinessDayId != null}">
							<form th:action="@{/confirm}" method="post" id="slotForm"
								class="h-100">
								<input type="hidden" name="businessDayId"
									th:value="${selectedBusinessDayId}" />
								<div class="p-4">
									<label class="form-label mb-3">時間枠を選択：</label>
									<div class="d-flex flex-column gap-3 mb-4"
										style="max-height: 800px; overflow-y: auto;">
										<div th:each="slotId, iter : ${allTimeSlotIds}"
											class="d-flex align-items-center gap-3"
											style="margin-bottom: 4px;"
											th:styleappend="${iter.last} ? 'margin-bottom:0;' : ''">
											<span th:switch="${slotId}"
												style="min-width: 70px; text-align: right;"> <span
												th:case="'1'">9:00~</span> <span th:case="'2'">9:30~</span>
												<span th:case="'3'">10:00~</span> <span th:case="'4'">10:30~</span>
												<span th:case="'5'">11:00~</span> <span th:case="'6'">11:30~</span>
												<span th:case="'7'">13:00~</span> <span th:case="'8'">13:30~</span>
												<span th:case="'9'">14:00~</span> <span th:case="'10'">14:30~</span>
												<span th:case="'11'">15:00~</span> <span th:case="'12'">15:30~</span>
												<span th:case="'13'">16:00~</span> <span th:case="'14'">16:30~</span>
												<span th:case="*">?</span>
											</span>
											<button type="button" th:data-slot-id="${slotId}"
												th:text="'選択'"
												th:classappend="${bookedSlotIds.contains(slotId) ? 'btn btn-secondary disabled' : 'btn btn-primary'}"
												th:disabled="${bookedSlotIds.contains(slotId)}"
												onclick="selectSlot(this)"></button>
										</div>
									</div>
									<input type="hidden" id="selectedTimeSlotId" name="timeSlotId" />
									<div id="reserveBtnArea" style="display: none;">
										<button type="submit" class="btn btn-primary">予約する</button>
									</div>
								</div>
							</form>
						</div>
						<div th:unless="${selectedBusinessDayId != null}"
							class="h-100 d-flex align-items-center justify-content-center"
							style="min-height: 200px;">
							<span class="text-secondary">営業日を選択してください</span>
						</div>
					</div>
				</div>
			</div>
			<!-- /col -->
		</div>
		<!-- /row -->
	</div>
	<footer th:replace="~{parts/common :: footer()}"></footer>
	<script>
		function selectSlot(btn) {
			document.querySelectorAll('#slotForm button[type=button]').forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
			document.getElementById('selectedTimeSlotId').value = btn.getAttribute('data-slot-id');
			document.getElementById('reserveBtnArea').style.display = '';
		}
	</script>
</body>
</html>