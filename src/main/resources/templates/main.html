<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{parts/common :: html_head('診断予約 - さわやか医院予約システム')}"></head>
<body>
	<header th:replace="~{parts/common :: header()}"></header>
	<div class="container py-4">
		<h2>予約時間を選択</h2>
		<!-- 営業日選択フォーム -->
		<form th:action="@{/main}" method="get" id="daySelectForm"
			class="mb-4">
			<label for="businessDayId" class="form-label">営業日を選択：</label> <select
				name="businessDayId" id="businessDayId" class="form-select"
				onchange="document.getElementById('daySelectForm').submit()">
				<option th:each="day : ${businessDays}" th:value="${day.id}"
					th:selected="${day.id eq selectedBusinessDayId}"
					th:text="${#temporals.format(day.businessDate, 'yyyy/MM/dd (E)', 'Asia/Tokyo')}">
				</option>
			</select>
		</form>

		<!-- 時間枠選択フォーム -->
		<div th:if="${selectedBusinessDayId != null}">
			<form th:action="@{/confirm}" method="post" id="slotForm">
				<div class="d-flex flex-column gap-2 mb-4">
					<!-- 時間枠ごとに横並びでラベル＋ボタン表示 -->
					<div th:each="slotId : ${allTimeSlotIds}"
						class="d-flex align-items-center gap-3">
						<!-- 静的ラベル -->
						<span th:switch="${slotId}"> <span th:case="'1'">9:00</span>
							<span th:case="'2'">9:30</span> <span th:case="'3'">10:00</span>
							<span th:case="'4'">10:30</span> <span th:case="'5'">11:00</span>
							<span th:case="'6'">11:30</span> <span th:case="'7'">13:00</span>
							<span th:case="'8'">13:30</span> <span th:case="'9'">14:00</span>
							<span th:case="'10'">14:30</span> <span th:case="'11'">15:00</span>
							<span th:case="'12'">15:30</span> <span th:case="'13'">16:00</span>
							<span th:case="'14'">16:30</span> <span th:case="*">?</span>
						</span>
						<!-- 枠選択ボタン -->
						<button type="button" th:data-slot-id="${slotId}" th:text="'選択'"
							th:classappend="${bookedSlotIds.contains(slotId) ? 'btn btn-secondary disabled' : 'btn btn-primary'}"
							th:disabled="${bookedSlotIds.contains(slotId)}"
							onclick="selectSlot(this)"></button>
					</div>
				</div>
				<input type="hidden" id="selectedTimeSlotId" name="timeSlotId" />
				<div id="reserveBtnArea" style="display: none;">
					<button type="submit" class="btn btn-primary">予約する</button>
				</div>
			</form>
		</div>
	</div>
	<footer th:replace="~{parts/common :: footer()}"></footer>

	<script>
		function selectSlot(btn) {
			document.querySelectorAll('#slotForm button[type=button]').forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
			document.getElementById('selectedTimeSlotId').value = btn.getAttribute('data-slot-id');
			document.getElementById('reserveBtnArea').style.display = '';
		}
	</script>
</body>
</html>